{% extends 'base.html' %}
{% block head %}
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/show_candidates.css') }}">
{% endblock %}

{% block body %}
<a href="{{ url_for('dashboard') }}"><input type="button" value="BACK" id='back'></a>
<center>
<h1>CANDIDATE REFERENCE</h1>
<div style="display:flex;" id='main'>
<div id='col1' class="col">
    {% for x in ['Head Boy','Head Girl','Sports Captain','Cultural Captain'] %}
    <div>
        <button  class='infirst' onclick="show(this);" id="{{ x }}" >{{ x }}</button>
    </div>
    {% endfor %}
</div>

<div id='col2' class="col">
    {% set x=['Kingfisher','Flamingo','Falcon','Eagle'] %}
    <div>
        <button class='insecond' style='background-color:#03A9F4' onclick="show(this);" id="{{ x[0]+' Captain' }}">{{ x[0]+' House Captain' }}</button>
    </div>
    <div>
        <button class='insecond' style='background-color:#FF6D00' onclick="show(this);" id="{{ x[1]+' Captain' }}">{{ x[1]+' House Captain' }}</button>
    </div>
    <div>
        <button class='insecond' style='background-color:#7E57C2' onclick="show(this);" id="{{ x[2]+' Captain' }}">{{ x[2]+' House Captain' }}</button>
    </div>
    <div>
        <button class='insecond' style='background-color:#B71C1C' onclick="show(this);" id="{{ x[3]+' Captain' }}">{{ x[3]+' House Captain' }}</button>
    </div>
</div>

<div id='col3' class="col">
    {% for x in ['Assistant Head Boy','Assistant Head Girl','Sports Vice Captain','Cultural Vice Captain'] %}
    <div>
        <button  class='inthird' onclick="show(this);" id="{{ x }}">{{ x }}</button>
    </div>
    {% endfor %}
</div>

<div id='col4' class="col">
    {% set x=['Kingfisher','Flamingo','Falcon','Eagle'] %}
    <div>
        <button class='infourth' style='background-color:#03A9F4' onclick="show(this);" id="{{ x[0]+' Vice Captain' }}">{{ x[0]+' House Vice Captain' }}</button>
    </div>
    <div>
        <button class='infourth' style='background-color:#FF6D00' onclick="show(this);" id="{{ x[1]+' Vice Captain' }}">{{ x[1]+' House Vice Captain' }}</button>
    </div>
    <div>
        <button class='infourth' style='background-color:#7E57C2' onclick="show(this);" id="{{ x[2]+' Vice Captain' }}">{{ x[2]+' House Vice Captain' }}</button>
    </div>
    <div>
        <button class='infourth' style='background-color:#B71C1C' onclick="show(this);" id="{{ x[3]+' Vice Captain' }}">{{ x[3]+' House Vice Captain' }}</button>
    </div>
</div>
</div>
<p id="storage" style="display: none;">{{ candidates }}</p>
</center>
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <center>
            <h1 id="modal_heading"></h1>
            <div id="prev_names">
            {% for x in range(5) %}
                <input type='text' id="{{ 'candidate'+str(x) }}" class="in_modal_candidates"> 
                <br>
            {% endfor %}
            <button onclick="update_candidates();" id='update'>UPDATE</button>
            <form method="POST"><input type="submit" value="CONFIRM CHANGES" id='confirm'><input type='hidden' id='candvalue' name='candvalue'></form>
            </div>
        </center>
    </div>
  
  </div>
<script>
//We fetch the id's of the elements we are working with
var data = document.getElementById('storage').innerHTML;
var modal = document.getElementById("myModal");
var span = document.getElementsByClassName("close")[0];
//We get  the candidates in the form of a dictionary
var candidates = JSON.parse(data.replace(/'/g,"\""))

function show(thing){
    //We change the name of the of the post of the modal box
    post = thing.id.toLowerCase().split(' ').join('_');
    //We show the box
    modal.style.display = "block";
    //We make the heading uppercase
    document.getElementById('modal_heading').innerHTML = thing.id.toUpperCase();
    var i;//temp var
    if (typeof candidates[post]  == "undefined"){
        //In case there is no post existing,we put no one
        candidates[post] = ['No one'];
        var x =0;
    }else{
        //Here we setup the variable to iterate the input tags of the modal box
        var x = candidates[post].length;
    }
    if (x>0){
        for (i=0;i<x;i++){
            //We change the value of the input tags one by one for the given number of posts
            document.getElementById('candidate'+i.toString()).value = candidates[post][i].toUpperCase();
        }
        for (i=x;i<5;i++){
            //For the remaining input tags,we change the value of the input tags
            document.getElementById('candidate'+i.toString()).value = '';
        }
    }else {
        for (i=0;i<5;i++){
            //If x is zero,that is, there is no post ,hence value changed to none
            document.getElementById('candidate'+i.toString()).value = "";
        }
    }
    var text,bg,candidates_names;
    //Here we modify the background and the text colours according to the post
    if (post.slice(0,10) == 'kingfisher'){
        text = "#9ed7f6";
        bg = "#036f96";
        candidates_names = "white";
    }
    else if (post.slice(0,8) == 'flamingo'){
        bg = "#E05707";
        text = "#A63A0F";
        candidates_names = "white";
    }
    else if (post.slice(0,6) == 'falcon'){
        text = "#7E58BF";
        bg = "#432A73";
        candidates_names = "white";
    }
    else if (post.slice(0,5) == 'eagle'){
        text = "#B81A1C";
        bg = "#750407";
        candidates_names = "white";
    }
    else{
        text = "#FCED47";
        bg  = "black";
        candidates_names = "#FCED47";
    }
    //In this block we update the modal block
    modal_box = document.getElementsByClassName('modal-content')[0];
    modal_box.style.color = text;
    modal_box.style.backgroundColor= bg ;
    modal_box.style.border = "1px solid "+ text;
    modal_text_list = document.getElementsByClassName("in_modal_candidates");
    update_button = document.getElementById('update');
    confirm_button = document.getElementById('confirm');

    //In this block we update the input tags individually 
    var x = modal_text_list.length;
    for (i=0;i<x;i++){
        modal_text_list[i].style.color = candidates_names;
        modal_text_list[i].style.backgroundColor = bg;
        modal_text_list[i].style.border = '1px solid '+candidates_names;
    }

    //In this block we update the update button
    update_button.style.backgroundColor = bg;
    update_button.style.color = candidates_names;

    //In this block we update the confirm button
    confirm_button.style.backgroundColor = bg;
    confirm_button.style.color = candidates_names;
    
    //This block changes the class so that we can have the borders
    if (candidates_names == "white"){
        $('#update').attr('class','house_border');
        $('#confirm').attr('class','house_border');
    }else{
        $('#update').attr('class','major_border');
        $('#confirm').attr('class','major_border');
    }

    //Here we have to hide the confirm button and show the update button
    $('#confirm').css('display','none');
    $('#update').show('display','block');
}
function update_candidates(){
    //In this block we get the post by parsing
    heading = document.getElementById("modal_heading").innerHTML;
    x = heading.length;
    for (i=0;i<x;i++){
        heading = heading.replace(' ','_');
    }
    post = heading.toLowerCase();
    var new_candidates= [];
    
    //In this block we create a dictionary with the post as key and the candidate names as a list which is the key value
    //It is parsed so that the flask can interpret it 
    modal_text_list = document.getElementsByClassName("in_modal_candidates");
    var x = modal_text_list.length;
    for (i=0;i<x;i++){
        new_candidates[i] = modal_text_list[i].value;
    }
    candidates[post] = new_candidates;
    var s = "{";
    for (var key in candidates){
        s = s + "'" + key +"':" +'[';
        y = candidates[key].length;
        for (x=0;x<y;x++){
            s = s+"'"+candidates[key][x]+"'";
            if (x !== candidates[key].length - 1){
                s = s+',';
            }
        }
        s = s+'],';
    }
    s= s.slice(0,-1);
    s  = s + '}';

    document.getElementById("candvalue").value = s;
    //Here we capitalize the text in the input boxes to show the update
    var x = modal_text_list.length;
    for (i=0;i<x;i++){
        modal_text_list[i].value = modal_text_list[i].value.toUpperCase();
    }

    //Hide the update buttion
    $('#update').css('display','none');
    //Show the confirm button
    $('#confirm').css('display','block');
}

span.onclick = function() {
  modal.style.display = "none"; 
}

</script>


{% endblock %}